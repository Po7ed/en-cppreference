<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script src="https://testingcf.jsdelivr.net/npm/flexsearch@0.7.31/dist/flexsearch.bundle.js"></script>

<style>
body {
  font-family: "Noto Sans", "Noto Sans SC", "Source Sans Pro", "Source Han Sans", "Microsoft YaHei", system-ui, sans-serif;
  max-width: 600px;
  margin: 40px auto;
  padding: 0 16px;
  line-height: 1.5;
  color: #111;
}

h1 {
  font-size: 26px;
  margin-bottom: 20px;
  font-weight: 600;
}

input {
  font-family: "Cascadia Mono NF", "Cascadia Mono", Consolas, "Courier New", monospace;
}

select {
  font-family: "Noto Sans", "Noto Sans SC", "Source Sans Pro", "Source Han Sans", "Microsoft YaHei", system-ui, sans-serif;
}

a.res {
  font-family: "Cascadia Mono NF", "Cascadia Mono", Consolas, "Courier New", monospace;
}

#topbar {
  display: flex;
  gap: 10px;
  margin-bottom: 16px;
}

#lang, #q {
  padding: 10px 14px;
  font-size: 15px;
  border: 1px solid #ccc;
  border-radius: 8px;
}

#lang {
  width: 120px;
}

#q {
  flex: 1;
}

#results a {
  display: block;
  padding: 12px 14px;
  margin: 8px 0;
  border-radius: 8px;
  text-decoration: none;
  color: #0366d6;
  background: #fafafa;
  border: 1px solid #eee;
  transition: background 0.15s, border-color 0.15s;
}

#results a:hover {
  background: #f0f7ff;
  border-color: #d0e3ff;
}
</style>
</head>

<body>

<h1>Search</h1>

<div id="topbar">
  <select id="lang">
    <option value="en">English</option>
    <option value="zh">中文</option>
  </select>

  <input id="q" placeholder="Type to search">
</div>

<div id="results"></div>

<script>
(async () => {
  const data = await fetch("search.json").then(r => r.json());
  const index = {
    en: new FlexSearch.Index({ tokenize:"forward" }),
    zh: new FlexSearch.Index({ tokenize:"forward" })
  };
  const store = { en:[], zh:[] };

  data.forEach((it) => {
    const arr = store[it.lang];
    const pos = arr.length;
    arr.push(it);
    index[it.lang].add(pos, it.title);
  });

  const q = document.getElementById("q");
  const lang = document.getElementById("lang");
  const out = document.getElementById("results");

  q.addEventListener("input", () => {
    const L = lang.value;
    const key = q.value.trim();
    if (!key) { out.innerHTML = ""; return; }

    const ids = index[L].search(key, 20);
    out.innerHTML = ids.map(id => {
      const item = store[L][id];
      return `<a class="res" href="${item.url}">${item.title}</a>`;
    }).join("");
  });
})();
</script>

</body>
</html>
