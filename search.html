<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script src="https://testingcf.jsdelivr.net/npm/flexsearch@0.7.31/dist/flexsearch.bundle.js"></script>
<style>
#results a { display:block; margin:4px 0; }
</style>
</head>
<body>
<select id="lang">
  <option value="en">English</option>
  <option value="zh">中文</option>
</select>
<input id="q" placeholder="search">
<div id="results"></div>

<script>
(async () => {
  const data = await fetch("search.json").then(r => r.json());
  const index = {
    en: new FlexSearch.Index({ tokenize:"forward" }),
    zh: new FlexSearch.Index({ tokenize:"forward" })
  };
  const store = { en:[], zh:[] };

  data.forEach((it, i) => {
    store[it.lang].push(it);
    index[it.lang].add(store[it.lang].length - 1, it.title);
  });

  const q = document.getElementById("q");
  const lang = document.getElementById("lang");
  const out = document.getElementById("results");

  q.addEventListener("input", () => {
    const L = lang.value;
    const ids = index[L].search(q.value, 20);
    out.innerHTML = ids.map(id => {
      const item = store[L][id];
      return `<a href="${item.url}">${item.title}</a>`;
    }).join("");
  });
})();
</script>
</body>
</html>
